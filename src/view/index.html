<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Firebase Push Notification</title>
    <meta charset="UTF-8" />
    <meta name="google-site-verification" content="402S1lz2mc8fz4QLmeS2hoccoivOaKbwceBcMrP02v8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      TestFCM.online - Test Firebase Push Notifications
    </title>

    <!-- Hreflang Tags -->
    <link rel="alternate" href="https://testfcm.online" hreflang="en" />
    <link rel="alternate" href="https://testfcm.online" hreflang="en-IN" />
    <link rel="alternate" href="https://testfcm.online" hreflang="x-default" />

    <!-- SEO Meta Tags -->
    <meta name="robots" content="index, follow" />
    <meta
      name="google-site-verification"
      content="GUdbxTzHtoC8xGDhFRTwbbXOpyoPo3ACgNE6efcf8E4"
    />
    <meta
      name="description"
      content="TestFCM.online is a tool for testing Firebase Cloud Messaging (FCM) push notifications. Validate your access tokens, device tokens, and test notifications in real-time."
    />
    <meta
      name="keywords"
      content="TestFCM, Firebase Cloud Messaging, FCM Push Notifications, Push Notification Testing, Firebase Notifications, FCM Token Validator"
    />
    <meta name="author" content="TestFCM.online" />
    <link rel="canonical" href="https://testfcm.online" />

    <!-- Open Graph Meta Tags -->
    <meta
      property="og:title"
      content="TestFCM.online - Test Firebase Cloud Messaging Push Notifications"
    />
    <meta
      property="og:description"
      content="Easily test Firebase Cloud Messaging (FCM) push notifications. Validate access tokens, send test notifications, and troubleshoot device connectivity issues."
    />
    <meta
      property="og:image"
      content="https://testfcm.online/asset/image/logo.jpg"
    />
    <meta property="og:url" content="https://testfcm.online" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="https://testfcm.online" />
    <meta
      name="twitter:title"
      content="TestFCM.online - Test FCM Push Notifications"
    />
    <meta
      name="twitter:description"
      content="TestFCM.online provides a simple way to validate and test Firebase Cloud Messaging (FCM) push notifications."
    />
    <meta
      name="twitter:image"
      content="https://testfcm.online/asset/image/logo.jpg"
    />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link href="asset/style.css" rel="stylesheet"/>
  </head>
  <body>
    <header class="py-3 mb-2">
      <div class="container d-flex justify-content-between align-items-center">
        <a href="/">
          <h1 class="h4 mb-0"><b> Push Notification Tester </b></h1>
        </a>
        <nav class="d-flex align-items-center">
          <a href="generate-device-token" class="text-decoration-none me-3 text-primary">Generate device token</a>
          <a href="#" class="text-decoration-none me-3 text-primary">Documentation</a>
          <button class="btn btn-signin"> Contribute </button>
        </nav>
      </div>
    </header>

    <div class="container py-1">
      <div class="card shadow">
      <div class="d-flex justify-content-between">
        <div class="card-body">
          <h6 class="text-start mb-2"><b>Push Notification Details</b></h5>
            <form id="pushNotificationForm">
              <!-- Access Token or Service File Toggle -->
              <div class="mb-2">
                <label class="form-label">Authentication Method</label>
                <div class="d-flex gap-3">
                  <div>
                    <input
                      type="radio"
                      id="useServiceFile"
                      name="authMethod"
                      value="serviceFile"
                      checked
                    />
                    <label for="useServiceFile">Private Key JSON</label>
                  </div>
                  <div>
                    <input
                      type="radio"
                      id="useAccessToken"
                      name="authMethod"
                      value="accessToken"
                    />
                    <label for="useAccessToken">Access Token</label>
                  </div>
                </div>
              </div>
            
              <!-- Access Token Input -->
              <div id="accessTokenSection" style="display: none;">
                <label for="accessToken" class="form-label">Access Token (Required)</label>
                <div class="d-flex">
                  <input
                    type="text"
                    class="form-control me-2"
                    id="accessToken"
                    placeholder="Enter access token"
                  />
                  <button
                    type="button"
                    class="generate-token-btn btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#generateTokenModal"
                  >
                    Generate Here
                  </button>
                </div>
                <div class="mb-2">
                  <label for="projectId" class="form-label">Project ID (Required)</label>
                  <input
                    type="text"
                    class="form-control"
                    id="projectId"
                    placeholder="Example: project-12345"
                  />
                </div>
              </div>
            
              <!-- Service File Input -->
              <div id="serviceFileSection" >
                <label for="serviceFile" class="form-label">Private Key JSON (Required)</label>
                <input type="file" class="form-control" id="serviceFile" accept=".json" />
              </div>
            
              <div class="mb-2">
                <label for="deviceToken" class="form-label">Device Token (Required)</label>
                <input
                  type="text"
                  class="form-control"
                  id="deviceToken"
                  placeholder="Example: abc123-device"
                />
              </div>
            
             
            
              <div class="mb-2">
                <label for="title" class="form-label">Title (Required)</label>
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  placeholder="Example: Welcome Message"
                />
              </div>
            
              <div class="mb-2">
                <label for="message" class="form-label">Message (Required)</label>
                <textarea
                  class="form-control"
                  id="message"
                  rows="2.5"
                  placeholder="Example: Hello, welcome to our service!"
                ></textarea>
              </div>
            
              <!-- Toggle for optional fields -->
              <div class="d-flex justify-content-center mb-3">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-secondary"
                  id="toggleOptionalFields"
                >
                  Show Optional Fields
                </button>
              </div>
            
              <!-- Optional fields -->
              <div id="optionalFields" style="display: none;">
                <div class="mb-2">
                  <label for="icon" class="form-label">Icon URL (Optional)</label>
                  <input
                    type="text"
                    class="form-control"
                    id="icon"
                    placeholder="Example: https://example.com/icon.png"
                  />
                </div>
            
                <div class="mb-2">
                  <label for="data" class="form-label">Data (Optional)</label>
                  <textarea
                    class="form-control"
                    id="data"
                    rows="3"
                    placeholder="Enter JSON data"
                  ></textarea>
                </div>
              </div>
            
              <div class="d-flex justify-content-start">
                <button type="submit" class="btn btn-primary me-1 btn-sm">
                  Send Push Notification
                </button>
                <button type="reset" class="btn btn-outline-secondary btn-sm">
                  Reset Form
                </button>
              </div>
            </form>
            
        </div>
      </div>
    </div>

      <div class="mt-5">
        <h2>Frequently Asked Questions</h2>
        <div class="faq-item">
          <button
            class="btn"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#faq1"
          >
            How do I get my device token?
          </button>
          <div id="faq1" class="collapse">
            Device tokens can be obtained from your mobile app's push
            notification registration process.
          </div>
        </div>

        <div class="faq-item">
          <button
            class="btn"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#faq2"
          >
            What format should the data field be in?
          </button>
          <div id="faq2" class="collapse">
            The data field should be a valid JSON object containing key-value
            pairs.
          </div>
        </div>
      </div>

      <div class="mt-5 d-flex justify-content-start">
        <button
          class="btn btn-info me-1"
          data-bs-toggle="modal"
          data-bs-target="#contactSupportModal"
        >
          Contact Support
        </button>
        <button
          class="btn btn-warning"
          data-bs-toggle="modal"
          data-bs-target="#reportIssueModal"
        >
          Report an Issue
        </button>
      </div>
    </div>

    <footer class="text-center mt-5">
      <p>&copy; 2025 Push Notification Tester. All rights reserved.</p>
    </footer>

    <!-- Generate Token Modal -->
    <div
      class="modal fade"
      id="generateTokenModal"
      tabindex="-1"
      aria-labelledby="generateTokenModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="generateTokenModalLabel">
              Provide Private Key
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Form for Private Key -->
            <form id="generateTokenForm">
              <!-- Private Key JSON Input -->
              <div class="mb-3" id="privateKeyJSONContainer">
                <label for="privateKeyJSON" class="form-label"
                  >Private Key JSON</label
                >
                <textarea
                  class="form-control"
                  id="privateKeyJSON"
                  rows="5"
                  placeholder="Paste your Private Key JSON here"
                ></textarea>
              </div>

              <!-- Private Key File Input -->
              <div class="mb-3" id="privateKeyFileContainer">
                <label for="privateKeyFile" class="form-label"
                  >Upload Private Key File</label
                >
                <input type="file" class="form-control" id="privateKeyFile" />
                <button
                  type="button"
                  class="btn btn-danger mt-2"
                  id="removeFileBtn"
                >
                  Remove File
                </button>
              </div>

              <!-- Generate Token Button -->
              <div class="d-grid mt-4">
                <button
                  type="button"
                  class="btn btn-primary"
                  id="generateTokenBtn"
                >
                  Generate Access Token
                </button>
              </div>
            </form>

            <small class="text-danger text-s">
              Note : We do not store your private key. It is used only to
              generate the Access Token. Choose either to paste your private key
              JSON or upload a private key file.
            </small>

            <a href="#" class="d-block mt-3"
              >Don't know where to get the private key? Click here.</a
            >
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="contactSupportModal"
      tabindex="-1"
      aria-labelledby="contactSupportLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="contactSupportLabel">
              Contact Support
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>Reach us at support@example.com or call +1-800-555-1234.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Issue Modal -->
    <div
      class="modal fade"
      id="reportIssueModal"
      tabindex="-1"
      aria-labelledby="reportIssueLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reportIssueLabel">Report an Issue</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="issueDescription" class="form-label"
                  >Issue Description</label
                >
                <textarea
                  class="form-control"
                  id="issueDescription"
                  rows="4"
                  placeholder="Describe the issue you're facing..."
                ></textarea>
              </div>
              <button type="submit" class="btn btn-warning">Submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="firebase.js" type="module" ></script>

<script>
  $(document).ready(function () {
  // Toggle authentication method
  $("input[name='authMethod']").on("change", function () {
    const selectedMethod = $("input[name='authMethod']:checked").val();
    if (selectedMethod === "accessToken") {
      $("#accessTokenSection").show();
      $("#serviceFileSection").hide();
    } else {
      $("#accessTokenSection").hide();
      $("#serviceFileSection").show();
    }
  });

  // Show or hide optional fields
  $("#toggleOptionalFields").on("click", function () {
    const optionalFields = $("#optionalFields");
    if (optionalFields.is(":visible")) {
      optionalFields.hide();
      $(this).text("Show Optional Fields");
    } else {
      optionalFields.show();
      $(this).text("Hide Optional Fields");
    }
  });

  // Handle form submission
  $("#pushNotificationForm").on("submit", function (e) {
    e.preventDefault();

    // Collect form data
    const authMethod = $("input[name='authMethod']:checked").val();
    const deviceToken = $("#deviceToken").val().trim();
    const projectId = $("#projectId").val().trim();
    const title = $("#title").val().trim();
    const body = $("#message").val().trim();
    const icon = $("#icon").val().trim();
    let data = {};
    try {
      const dataInput = $("#data").val().trim();
      if (dataInput) {
        data = JSON.parse(dataInput);
      }
    } catch (err) {
      Swal.fire({
        icon: "error",
        title: "Invalid Data",
        text: "The data field must contain valid JSON.",
      });
      return; 
    }


    let payload = {
      deviceToken,
      projectId,
      title,
      body,
      icon,
      data,
    };

    // Validate required fields
    if (!deviceToken || !title || !body || (!projectId && authMethod=='accessToken')) {
      Swal.fire({
        icon: "error",
        title: "Validation Error",
        text: "Please fill all required fields.",
      });
      return;
    }

    // Handle authentication
    if (authMethod === "accessToken") {
      const accessToken = $("#accessToken").val().trim();
      if (!accessToken) {
        Swal.fire({
          icon: "error",
          title: "Validation Error",
          text: "Access Token is required.",
        });
        return;
      }
      payload.accessToken = accessToken;
    } else {
      const serviceFile = $("#serviceFile")[0].files[0];
      if (!serviceFile) {
        Swal.fire({
          icon: "error",
          title: "Validation Error",
          text: "Private key json File is required.",
        });
        return;
      }

      // Read file content and send as JSON
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          payload.serviceAccount = JSON.parse(e.target.result);
          sendPushNotification(payload);
        } catch (err) {
          Swal.fire({
            icon: "error",
            title: "File Error",
            text: "Invalid JSON file.",
          });
        }
      };
      reader.readAsText(serviceFile);
      return; // Exit here as the file reading is asynchronous
    }

    // Send push notification
    sendPushNotification(payload);
  });

  // API call to initiate push notification
  function sendPushNotification(payload) {
    $.ajax({
      url: "/api/initiate-notification",
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify(payload),
      success: function (response) {
        if (response.success) {
          Swal.fire({
            icon: "success",
            title: "Notification Sent",
            text: "Push notification has been successfully sent.",
          });
        } else {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: response.message || "Failed to send push notification.",
          });
        }
      },
      error: function (xhr) {
        Swal.fire({
          icon: "error",
          title: "Error",
          text: xhr.responseJSON?.message || "An unexpected error occurred.",
        });
      },
    });
  }
});


  // Handle file removal button
  $('#generateTokenModal').on('hidden.bs.modal', function () {
      // Reset the form
      $("#generateTokenForm")[0].reset();
      $("#privateKeyFile").val("");
      $("#privateKeyJSON").val("");
      // Hide the "Remove File" button initially
      $("#removeFileBtn").hide();
  });

  $("#removeFileBtn").on("click", function () {
    $("#privateKeyFile").val(""); // Clear the file input
    $(this).hide(); // Hide the "Remove File" button
  });

  // Handle file input change
  $("#privateKeyFile").on("change", function () {
    if (this.files && this.files[0]) {
      // Show "Remove File" button if a file is uploaded
      $("#removeFileBtn").show();
    } else {
      // Hide "Remove File" button if no file is selected
      $("#removeFileBtn").hide();
    }
    
  });


  // Handle Generate Access Token button click
  $("#generateTokenBtn").on("click", function (e) {
    e.preventDefault();

    const privateKeyJSON = $("#privateKeyJSON").val().trim();
    const privateKeyFile = $("#privateKeyFile")[0].files[0];
    const apiUrl = "/api/generate-access-token"; // Your API endpoint

    // Validate input
    if (!privateKeyJSON && !privateKeyFile) {
      Swal.fire({
        icon: "error",
        title: "Validation Error",
        text: "Please provide either a private key JSON or upload a private key file.",
      });
      return;
    }

    // Show a loading state
    Swal.fire({
      title: "Generating Access Token...",
      allowOutsideClick: false,
      didOpen: () => {
        Swal.showLoading();
      },
    });

    // Function to send the API request
    const sendRequest = (jsonContent) => {
      const payload = jsonContent;
      console.log(payload);
      
      // Make API request
      $.ajax({
        url: apiUrl,
        type: "POST",
        contentType: "application/json",
        data: payload,
        success: function (response) {
          if (response.success) {
            Swal.fire({
              icon: "success",
              title: "Access Token Generated",
              html: `
                <p>Access Token:</p>
                <textarea class="form-control" id="accessToken" readonly rows="5">${response.data.accessToken}</textarea>
              `,
              footer: `
                <button id="copyAccessTokenBtn" class="btn btn-secondary">Copy and Close</button>
                <button id="closeSwalBtn" class="btn btn-primary">Close</button>
              `,
              showConfirmButton: false, // Hide the default confirm button
              didOpen: () => {
                // Handle the "Copy" button click
                document.getElementById("copyAccessTokenBtn").addEventListener("click", () => {
                  const accessToken = document.getElementById("accessToken");
                  accessToken.select(); // Select the text in the textarea
                  accessToken.setSelectionRange(0, 99999); // For mobile devices
                  $('#generateTokenModal').modal('hide');

                  navigator.clipboard
                    .writeText(accessToken.value)
                    .then(() => {
                      Swal.fire({
                        icon: "success",
                        title: "Copied!",
                        text: "Access token copied to clipboard.",
                        timer: 1500,
                        showConfirmButton: false,
                      });
                      $('#generateTokenModal').modal('hide');
                    })
                    .catch(() => {
                      Swal.fire({
                        icon: "error",
                        title: "Copy Failed",
                        text: "Could not copy the access token.",
                        timer: 1500,
                        showConfirmButton: false,
                      });
                    });
    });

            // Handle the "Close" button click
            document.getElementById("closeSwalBtn").addEventListener("click", () => {
              Swal.close(); // Close the Swal modal
              $('#generateTokenModal').modal('hide');
              $("#privateKeyFile").val("");
            });
          },
        });

          } else {
            Swal.fire({
              icon: "error",
              title: "Error",
              text: response.message || "Failed to generate access token.",
            });
          }
        },
        error: function (xhr) {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: xhr.responseJSON?.error || "An unexpected error occurred.",
          });
        },
      });
    };

    // If file is uploaded, read its content
    if (privateKeyFile) {
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const fileContent = e.target.result;
          sendRequest(fileContent); // Send the file content as JSON
        } catch (err) {
          Swal.fire({
            icon: "error",
            title: "File Error",
            text: "Failed to read the file content.",
          });
        }
      };
      reader.onerror = function () {
        Swal.fire({
          icon: "error",
          title: "File Error",
          text: "An error occurred while reading the file.",
        });
      };
      reader.readAsText(privateKeyFile); // Read file as text
    } else {
      // Use the JSON string from the input field
      sendRequest(privateKeyJSON);
    }
  });

</script>